# I‑MAESTRO data preprocessing

This folder is the little factory that turns the I‑MAESTRO virtual forest landscapes into clean training patches for deep learning.

The dataset provides three virtual forest regions located in France (Bauges Geopark), Poland (Milicz Forest District), and Slovenia (Snežnik Forest).  
Each tree is generated by combining inventory plot data, vegetation maps, and Airborne Laser Scanning (ALS) data.  
In total, these landscapes cover >100,000 ha (≈64,000 ha forest) and contain more than 42 million trees from 51 species.

Sentinel‑1 SAR data are downloaded from ASF:  
<https://search.asf.alaska.edu/>

---

## What this folder does

- **Preprocess Sentinel‑1 GRD scenes**  
  Runs SNAP graphs to apply orbit files, radiometric calibration, terrain correction and reprojection, and exports VV/VH backscatter in dB, aligned to the structural rasters.

- **Stack Sentinel‑1 and structural layers into a common cube**  
  Combines `[VH, VV, biomass, genus, height]` into a single aligned array, so every pixel has both SAR and forest attributes in a fixed, documented channel order.

- **Extract patch‑level training data**  
  Cuts the big stacks into 64×64 patches with stride 32, filters out patches dominated by NoData, and assigns each patch to train/val/test via a block‑based spatial split to avoid leakage.

- **Handle masks, NaNs and ignore indices**  
  Normalizes and clips VV/VH, applies a dedicated `IGNORE_INDEX` for segmentation, and masks NaNs / invalid pixels consistently so both regression and segmentation see only valid targets.

---

## Key Inputs and Outputs

- **Inputs**  
  * Raw Sentinel‑1 GRD scenes (SAFE or GeoTIFF) for the three forest regions.  
  * Structural rasters: biomass, genus/class maps and canopy height, co‑registered to the Sentinel‑1 grid.  
  * Tiling configuration: patch size (64×64), stride (32), and spatial blocks defining train/val/test regions.

- **Intermediate outputs**  
  * Preprocessed VV/VH backscatter rasters in dB, terrain‑corrected and aligned to the structural layers.  
  * Stacked multi‑channel arrays with fixed order `[VH, VV, biomass, genus, height]`, plus corresponding masks.

- **Final outputs for training**  
  * Numpy patch files (e.g. `patches_train.npy`, `patches_val.npy`, `patches_test.npy`) containing the 5‑channel image cubes.  
  * Matching label/metadata arrays encoding genus indices, height/biomass values and the split (train/val/test) for each patch.  
  * Simple sanity‑check plots to verify VV/VH scaling, masks and class distributions before starting model training.